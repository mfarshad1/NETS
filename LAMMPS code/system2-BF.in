# sample LAMMPS input script for thermal conductivity of liquid LJ
# use fix ehex to add/subtract energy from 2 regions

# settings
# define a variable named "N" with a value of 10
variable        N equal 1000
variable        x equal 5.29
variable        y equal 10.58
variable        z equal 5.29

variable        rho equal 0.8444
variable        t equal 0.74
variable        rc equal 3.0

# setup problem
units           lj
atom_style      full
boundary        p p p

region          box block -$x $x -$y $y -$z $z
create_box      2 box
create_atoms    1 random ${N} 127569 box
create_atoms    2 random ${N} 341341 box

mass            1 1.0
mass            2 5.0

# Define potential
pair_style      lj/cut ${rc}
pair_coeff      1 1 1.0 1.0 
pair_coeff      2 2 1.0 1.0 
pair_coeff      1 2 1.0 1.0 

# Define groups and initial velocities
group           small type 1
group           large type 2
velocity        all create ${t} 87287 loop geom

# Set up simulation
neighbor        0.3 bin
neigh_modify    delay 5
timestep        0.001

# Define regions and compute temperature
region          hot block INF INF -5.0 -4.0 INF INF
region          cold block  INF INF 4.0 5.0 INF INF
compute         Thot all temp/region hot
compute         Tcold all temp/region cold

# 1st equilibration run 1st step annealing
fix             1 all nve
fix             2 all temp/rescale 1 $t 1.44 0.05 1.0

minimize        1e-6 1e-4 10000 10000000

# Run equilibration
timestep        0.001
run             500000


# 2nd equilibration run 2nd step annealing
unfix           2

fix             2 all temp/rescale 1 1.44 $t 0.05 1.0
timestep        0.001
thermo          100
run             250000

# 3rd step equilibration NVT for target temperature
unfix           1
unfix           2

fix             1 all nvt temp $t $t 0.5
timestep        0.001
run             250000

# 4th step equilibration NVE for constant energy
unfix            1

fix             1 all nve
timestep        0.001
run             2500000

# Production run
unfix           1

fix             hot all ehex 1 35.0 region hot
fix             cold all ehex 1 -35.0 region cold
fix             4 all nve

group           myparticle_small id 1000
group           myparticle_large id 2000

# group           myparticle id ${N}
# compute         pe_particle myparticle pe/atom
# compute         ke_particle myparticle ke/atom
# compute         se_particle myparticle entropy/atom 0.25 2.5
# dump            dump_pe_single myparticle custom 100 energy_single.dat id x y z c_pe_particle c_ke_particle c_se_particle
# dump_modify     dump_pe_single flush yes pbc yes

# dump            dump_pe_large_single myparticle_large custom 100 position_large_single.dat id x y z
# dump_modify     dump_pe_large_single flush yes pbc yes

compute         pe_small small pe/atom
compute         ke_small small ke/atom
compute         se_small small entropy/atom 0.25 2.5

compute         pe_large large pe/atom
compute         ke_large large ke/atom
compute         se_large large entropy/atom 0.25 2.5

compute         layers_pe_large large chunk/atom bin/1d y lower 0.35266667 units box
compute         layers_ke_large large chunk/atom bin/1d y lower 0.35266667 units box
compute         layers_pe_small small chunk/atom bin/1d y lower 0.35266667 units box
compute         layers_ke_small small chunk/atom bin/1d y lower 0.35266667 units box

fix             potential_energy_avg_large large ave/chunk 100 10 1000 layers_pe_large c_pe_large file potential_avg_large.dat
fix             kinetic_energy_avg_large large ave/chunk 100 10 1000 layers_ke_large c_ke_large file kinetic_avg_large.dat
fix             potetial_energy_avg_small small ave/chunk 100 10 1000 layers_pe_small c_pe_small file potential_avg_small.dat
fix             kinetic_energy_avg_small small ave/chunk 100 10 1000 layers_ke_small c_ke_small file kinetic_avg_small.dat

dump            dump_pe_small small custom 100 small.dat id x y z vx vy vz c_pe_small c_ke_small c_se_small
dump_modify     dump_pe_small flush yes pbc yes

dump            dump_pe_large large custom 100 large.dat id x y z vx vy vz c_pe_large c_ke_large c_se_large
dump_modify     dump_pe_large flush yes pbc yes

compute         layers all chunk/atom bin/1d y lower 0.35266667 units box
fix             temperature_all all ave/chunk 100 10 1000 layers temp file temp.dat

compute         layers_small small chunk/atom bin/1d y lower 0.35266667 units box
fix             temperature_small small ave/chunk 100 10 1000 layers_small temp file temp_small.dat

compute         layers_large large chunk/atom bin/1d y lower 0.35266667 units box
fix             temperature_large large ave/chunk 100 10 1000 layers_large temp file temp_large.dat

compute         temp_all all temp
compute         pe_all   all pe
compute         ke_all   all ke

variable        tstep    equal step
variable        mytemp   equal c_temp_all
variable        mype     equal c_pe_all
variable        myke     equal c_ke_all

fix             system all print 100 "${tstep} ${mytemp} ${mype} ${myke}" file system_all_fix.dat screen "no" title "step temperature potential_energy kinetic_energy"

#dump            system all custom 100 system_all_dump.dat c_step c_temp c_pe c_ke
#dump_modify     system flush yes pbc yes


# Define compute for MSD
# compute         msdsmall_single myparticle_small msd
# compute         msdlarge_single myparticle_large msd

# Compute MSD in y-direction and output data to file
# fix             msdout_small_single myparticle_small ave/time 1 1 1000 c_msdsmall_single[2] file msd_small_single.dat mode scalar
# fix             msdout_large_single myparticle_large ave/time 1 1 1000 c_msdlarge_single[2] file msd_large_single.dat mode scalar

# Define compute for MSD
# compute 	msdsmall small msd
# compute         msdlarge large msd

# Compute MSD in y-direction and output data to file
# fix 		msdout_small small ave/time 1 1 1000 c_msdsmall[2] file msd_small.dat mode scalar
# fix             msdout_large large ave/time 1 1 1000 c_msdlarge[2] file msd_large.dat mode scalar

timestep        0.001
run             20000000
